<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Invaders Touch - ðŸ—½</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      background: radial-gradient(circle at center, #000012 0%, #000000 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #eee;
      -webkit-tap-highlight-color: transparent;
    }
    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      touch-action: none;
      user-select: none;
      overflow: hidden;
    }
    #hud {
      position: absolute;
      top: 12px;
      left: 12px;
      font-size: 18px;
      z-index: 1000;
      text-shadow: 0 0 6px #0ff;
    }
    #player {
      position: absolute;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 50px;
      user-select: none;
      pointer-events: none;
      filter: drop-shadow(0 0 6px cyan);
    }
    .enemy {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 6px;
      background: linear-gradient(135deg, #ff00ff, #cc00cc);
      box-shadow: 0 0 12px #f0f, 0 0 24px #f0f;
    }
    .bullet {
      position: absolute;
      width: 6px;
      height: 16px;
      border-radius: 4px;
      background: #0ff;
      filter: drop-shadow(0 0 6px #0ff);
    }
    .enemy-bullet {
      position: absolute;
      width: 6px;
      height: 16px;
      border-radius: 4px;
      background: #f00;
      filter: drop-shadow(0 0 6px #f00);
    }
    #game-over {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 42px;
      color: #ff0033;
      text-align: center;
      display: none;
      user-select: none;
      text-shadow: 0 0 12px #ff0033;
    }
    #game-over button {
      margin-top: 20px;
      font-size: 22px;
      padding: 10px 22px;
      border: none;
      border-radius: 8px;
      background: #ff0033;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 12px #ff0033;
    }
    #game-over button:hover {
      background: #ff3366;
    }
  </style>
</head>
<body>

<div id="game">
  <div id="hud">
    Score: <span id="score">0</span> |
    Lives: <span id="lives">3</span> |
    Stage: <span id="stage">1</span>
  </div>
  <div id="player">ðŸ—½</div>
  <div id="game-over">
    GAME OVER<br />
    <button onclick="restartGame()">Restart</button>
  </div>
</div>

<script>
  const game = document.getElementById('game');
  const player = document.getElementById('player');
  const scoreSpan = document.getElementById('score');
  const livesSpan = document.getElementById('lives');
  const stageSpan = document.getElementById('stage');
  const gameOverDiv = document.getElementById('game-over');

  let playerX = window.innerWidth / 2;
  const playerWidth = 50;
  let lives = 3;
  let score = 0;
  let stage = 1;
  let gameActive = true;

  function updateHUD() {
    scoreSpan.textContent = score;
    livesSpan.textContent = lives;
    stageSpan.textContent = stage;
  }

  function clampPlayerX(x) {
    return Math.min(Math.max(x, playerWidth / 2), window.innerWidth - playerWidth / 2);
  }

  function setPlayerPosition(x) {
    playerX = clampPlayerX(x);
    player.style.left = playerX + 'px';
  }
  setPlayerPosition(playerX);

  game.addEventListener('touchstart', e => {
    if (!gameActive) return;
    setPlayerPosition(e.touches[0].clientX);
  });
  game.addEventListener('touchmove', e => {
    if (!gameActive) return;
    setPlayerPosition(e.touches[0].clientX);
  });

  function shootPlayerBullet() {
    if (!gameActive) return;
    const bullet = document.createElement('div');
    bullet.classList.add('bullet');
    bullet.style.left = (playerX - 3) + 'px';
    bullet.style.top = (window.innerHeight - 75) + 'px';
    game.appendChild(bullet);

    const bulletSpeed = 12;
    let bulletInterval = setInterval(() => {
      if (!gameActive) {
        bullet.remove();
        clearInterval(bulletInterval);
        return;
      }
      bullet.style.top = (bullet.offsetTop - bulletSpeed) + 'px';
      if (bullet.offsetTop < -20) {
        bullet.remove();
        clearInterval(bulletInterval);
        return;
      }
      document.querySelectorAll('.enemy').forEach(enemy => {
        if (checkCollision(bullet, enemy)) {
          score += 10;
          updateHUD();
          enemy.remove();
          bullet.remove();
          clearInterval(bulletInterval);
          if (score % 100 === 0 && stage < 10) {
            stage++;
            updateHUD();
          }
        }
      });
    }, 16);
  }

  setInterval(() => {
    if (gameActive) shootPlayerBullet();
  }, 300);

  function spawnEnemy() {
    if (!gameActive) return;
    const enemy = document.createElement('div');
    enemy.classList.add('enemy');
    enemy.style.left = (Math.random() * (window.innerWidth - 40)) + 'px';
    enemy.style.top = '-50px';
    game.appendChild(enemy);

    const baseSpeed = 2;
    const speed = baseSpeed + Math.random() * 2 + (stage * 0.2);
    const willShoot = Math.random() < 0.3;

    let enemyInterval = setInterval(() => {
      if (!gameActive) {
        enemy.remove();
        clearInterval(enemyInterval);
        return;
      }
      enemy.style.top = (enemy.offsetTop + speed) + 'px';

      if (willShoot && Math.random() < 0.008 + 0.002 * stage) {
        shootEnemyBullet(enemy.offsetLeft + 20, enemy.offsetTop + 40);
      }

      if (enemy.offsetTop > window.innerHeight) {
        enemy.remove();
        clearInterval(enemyInterval);
      }
    }, 16);
  }

  function enemySpawnLoop() {
    if (!gameActive) return;
    spawnEnemy();
    const spawnDelay = Math.max(1000 - stage * 80, 350);
    setTimeout(enemySpawnLoop, spawnDelay);
  }
  enemySpawnLoop();

  function shootEnemyBullet(x, y) {
    if (!gameActive) return;
    const bullet = document.createElement('div');
    bullet.classList.add('enemy-bullet');
    bullet.style.left = (x - 3) + 'px';
    bullet.style.top = y + 'px';
    game.appendChild(bullet);

    const bulletSpeed = 8;
    let bulletInterval = setInterval(() => {
      if (!gameActive) {
        bullet.remove();
        clearInterval(bulletInterval);
        return;
      }
      bullet.style.top = (bullet.offsetTop + bulletSpeed) + 'px';
      if (bullet.offsetTop > window.innerHeight) {
        bullet.remove();
        clearInterval(bulletInterval);
        return;
      }
      if (checkCollision(bullet, player)) {
        bullet.remove();
        clearInterval(bulletInterval);
        lives--;
        updateHUD();
        if (lives <= 0) endGame();
      }
    }, 16);
  }

  function checkCollision(a, b) {
    const aRect = a.getBoundingClientRect();
    const bRect = b.getBoundingClientRect();
    return !(
      aRect.top > bRect.bottom ||
      aRect.bottom < bRect.top ||
      aRect.left > bRect.right ||
      aRect.right < bRect.left
    );
  }

  function endGame() {
    gameActive = false;
    gameOverDiv.style.display = 'block';
  }

  function restartGame() {
    gameActive = true;
    lives = 3;
    score = 0;
    stage = 1;
    updateHUD();
    gameOverDiv.style.display = 'none';
    document.querySelectorAll('.enemy, .bullet, .enemy-bullet').forEach(el => el.remove());
    enemySpawnLoop();
  }
</script>
</body>
</html>